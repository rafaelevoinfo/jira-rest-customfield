(function(a){a.fn.autoCompleteCD=function(b){var d=a.extend({},a.fn.autoCompleteCD.defaults,b);d.multiChoiceDelimiterRE=new RegExp(d.multiChoiceDelimiter+"s*","g");function c(e){if(d.isLoggingEnabled){console.log&&console.log("Pixabay autoCompleteCD: ",e)}}if(typeof b=="string"){this.each(function(){var e=a(this);if(b=="destroy"){a(window).off("resize.autocompleteCD",e.updateSC);e.off("blur.autocompleteCD focus.autocompleteCD keydown.autocompleteCD keyup.autocompleteCD");if(e.data("autocompleteCD")){e.attr("autocompleteCD",e.data("autocompleteCD"))}else{e.removeAttr("autocompleteCD")}a(e.data("sc")).remove();e.removeData("sc").removeData("autocompleteCD")}});return this}return this.each(function(){var f=a(this);f.sc=a('<div class="autocompleteCD-suggestions '+d.menuClass+'"></div>');f.data("sc",f.sc).data("autocompleteCD",f.attr("autocompleteCD"));f.attr("autocompleteCD","off");f.cache={};f.last_val="";f.updateSC=function(j,k){f.sc.css({top:f.offset().top+f.outerHeight(),left:f.offset().left,width:f.outerWidth()});if(!j){f.sc.show();if(!f.sc.maxHeight){f.sc.maxHeight=parseInt(f.sc.css("max-height"))}if(!f.sc.suggestionHeight){f.sc.suggestionHeight=a(".autocompleteCD-suggestion",f.sc).first().outerHeight()}if(f.sc.suggestionHeight){if(!k){f.sc.scrollTop(0)}else{var h=f.sc.scrollTop(),l=k.offset().top-f.sc.offset().top;if(l+f.sc.suggestionHeight-f.sc.maxHeight>0){f.sc.scrollTop(l+f.sc.suggestionHeight+h-f.sc.maxHeight)}else{if(l<0){f.sc.scrollTop(l+h)}}}}}};a(window).on("resize.autocompleteCD",f.updateSC);f.sc.appendTo("body");f.sc.on("mouseleave",".autocompleteCD-suggestion",function(){a(".autocompleteCD-suggestion.selected").removeClass("selected")});f.sc.on("mouseenter",".autocompleteCD-suggestion",function(){a(".autocompleteCD-suggestion.selected").removeClass("selected");a(this).addClass("selected")});f.sc.on("mousedown click",".autocompleteCD-suggestion",function(j){var k=a(this);var h=k.data("val");if(h||k.hasClass("autocompleteCD-suggestion")){d.onSelect(j,f,g(f.val()),k);f.sc.hide()}return false});function g(h){var j;if(h.trim().length===0){j=""}else{lastDelimiterPosition=h.lastIndexOf(d.multiChoiceDelimiter);if(lastDelimiterPosition!==-1){j=h.slice(0,lastDelimiterPosition)}else{j=""}}return j}f.on("blur.autocompleteCD",function(){try{over_sb=a(".autocompleteCD-suggestions:hover").length}catch(h){over_sb=0}if(!over_sb){f.last_val=f.val();f.sc.hide();setTimeout(function(){f.sc.hide()},350)}else{if(!f.is(":focus")){setTimeout(function(){f.focus()},20)}}d.onBlur(f)});if(!d.minChars){f.on("focus.autocompleteCD",function(){f.last_val="\n";f.trigger("keyup.autocompleteCD")})}function e(l){var m=f.val();f.cache[m]=l;var k=m.split(d.multiChoiceDelimiterRE).pop().length;if(l.length&&k>=d.minChars){var j="";for(var h=0;h<l.length;h++){j+=d.renderChoiceElement(l[h],m)}f.sc.html(j);f.updateSC(0)}else{f.sc.hide()}}f.on("keydown.autocompleteCD",function(l){if((l.which==40||l.which==38)&&f.sc.html()){var j,k=a(".autocompleteCD-suggestion.selected",f.sc);if(!k.length){j=(l.which==40)?a(".autocompleteCD-suggestion",f.sc).first():a(".autocompleteCD-suggestion",f.sc).last();j.addClass("selected").data("val")}else{j=(l.which==40)?k.next(".autocompleteCD-suggestion"):k.prev(".autocompleteCD-suggestion");if(j.length){k.removeClass("selected");j.addClass("selected").data("val")}else{k.removeClass("selected");j=0}}f.updateSC(0,j);return false}else{if(l.which==27){f.val(f.last_val).sc.hide()}else{if(l.which==13||l.which==9){var m=a(".autocompleteCD-suggestion.selected",f.sc);if(m.length&&f.sc.is(":visible")){var h=m.data("val").replace(/[\n\r]*$/,"");d.onSelect(l,f,g(f.val()),m);l.preventDefault();setTimeout(function(){f.sc.hide()},20)}}}}});f.on("keyup.autocompleteCD",function(m){if(!~a.inArray(m.which,[13,27,35,36,37,38,39,40])){var h=f.val();var l=h.split(/,\s*/).pop().length;if(l>=d.minChars){if(h!=f.last_val){f.last_val=h;clearTimeout(f.timer);if(d.cache){if(h in f.cache){e(f.cache[h]);return}for(var k=1;k<h.length-d.minChars;k++){var j=h.slice(0,h.length-k);if(j in f.cache&&!f.cache[j].length){e([]);return}}}f.timer=setTimeout(function(){var n=h.split(d.multiChoiceDelimiterRE).pop().trim();d.source(n,d.choiceObjects,e)},d.delay)}}else{f.last_val=h;f.sc.hide()}}})})};a.fn.autoCompleteCD.defaults={minChars:2,delay:150,cache:false,menuClass:"",multiChoiceDelimiter:",",choiceObjects:[],source:function(c,e,d){var b=[];var f=c.toLowerCase();for(i=0;i<e.length;i++){if(~e[i].toLowerCase().indexOf(f)){b.push(e[i])}}d(b)},renderChoiceElement:function(d,b){b=b.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var c=new RegExp("("+b.split(" ").join("|")+")","gi");return'<div class="autocompleteCD-suggestion" data-val="'+d+'">'+d.replace(c,"<b>$1</b>")+"</div>"},onSelect:function(d,g,b,f){var c;if(b.trim().length===0){c=f.data("val")}else{c=b+", "+f.data("val")}g.val(c)},onBlur:function(b){}}}(jQuery));